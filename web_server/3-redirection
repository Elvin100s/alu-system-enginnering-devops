#!/usr/bin/env bash
# This script configures a new Ubuntu machine to set up Nginx and redirect /redirect_me to https://www.youtube.com/watch?v=QH2-TGUlwu4 with a 301 Moved Permanently status.

# Update package list and install nginx
sudo apt-get update
sudo apt-get install -y nginx

# Backup the default Nginx configuration
sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.backup

# Modify the Nginx configuration to include the redirect
sudo sed -i '/^server {/a \
    location = \/redirect_me {\n\
        return 301 https:\/\/www.youtube.com\/watch?v=QH2-TGUlwu4;\n\
    }' /etc/nginx/sites-available/default

# Ensure the default site is enabled
sudo ln -sf /etc/nginx/sites-available/default /etc/nginx/sites-enabled/

# Test the Nginx configuration
if sudo nginx -t; then
    # Reload Nginx to apply the changes
    if sudo systemctl is-active --quiet nginx; then
        sudo systemctl reload nginx
    else
        sudo systemctl start nginx
    fi
else
    echo "Nginx configuration test failed. Please check the configuration file."
fi
